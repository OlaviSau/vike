import { Link, RepoLink } from '@brillout/docpress'
import { UiFrameworkExtension, ImplementedBy } from '../../components'

Environment: client, and server if <Link href="/ssr">`ssr: true`</Link>.
<ImplementedBy>the `Layout` setting</ImplementedBy>

> **What are layouts?**
>
> Your pages will usually share a common visual design.
>
> Some pages may share a design while other pages share another design. (For example, two admin pages `/admin/product/@id` and `/admin/user/@id` sharing the same navigation sidebar, and two marketing pages `/` and `/about-us` not having any sidebar but sharing a sticky header instead.)
>
> The `Layout` setting enables you to define such shared visual appearance.

The component defined by the `Layout` setting wraps the <Link href="/Page">`<Page>` component</Link>.

```jsx
<Layout>   ⟸ component defined by the setting "Layout"
  <Page /> ⟸ component defined by the setting "Page"
</Layout>
```

> See also <Link href="/Wrapper">`<Wrapper>`</Link> which also wraps `<Page>`, but for different use cases.


## Global layout

You can define a layout that applies to all your pages:

```jsx
// /pages/+Layout.jsx

export { Layout }

// children includes <Page/>
function Layout({ children }) {
  return <>
    <Navigation/>
    <Content>{children}</Content>
  </>
}
function Navigation() { /* ... */ }
function Content() { /* ... */ }
```

> Why `/pages/+Layout.jsx` applies to all pages is explained at <Link href="/config#inheritance" />.

## Multiple layouts

You can define several layouts that apply to different groups of pages.

```yaml
# Marketing pages share a layout
pages/(marketing)/+Layout.js
pages/(marketing)/index/+Page.js    # URL: /
pages/(marketing)/about/+Page.js    # URL: /about

# Admin pages share another layout
pages/admin-panel/+Layout.js
pages/admin-panel/index/+Page.js    # URL: /admin-panel
pages/admin-panel/users/+Page.js    # URL: /admin-panel/users
```
> See <Link href="/config#inheritance" />.

> The directory `(marketing)` is skipped by Filesystem Routing, see <Link href="/routing#filesystem-routing" />.

> Setting a default `<Layout>` that is overridable isn't currently supported, see [#1692 - [Cumulative configs] New settings `override` and `default`](https://github.com/vikejs/vike/issues/1692).

## Nested Layouts


You can define layouts that nest into each other:

```yaml
# Global outer layout that applies to all pages
pages/+Layout.js
# Inner layout nested into the global outer layout, for marketing pages
pages/(marketing)/+Layout.js
# Inner layout nested into the global outer layout, for admin pages
pages/admin-panel/+Layout.js
```

Here `pages/+Layout.js` applies to all pages, including all marketing and admin pages.

> The `Layout` setting is cumulative: `pages/(marketing)/+Layout.js` doesn't override `pages/+Layout.js` but nests into it.
>
> The `<Layout>` components wrap into each other:
> ```jsx
> <Layout>      ⟸ pages/+Layout.js
>   <Layout>    ⟸ pages/(marketing)/+Layout.js
>     <Page />  ⟸ pages/(marketing)/about-us/+Page.js
>   </Layout>
> </Layout>
> ```

You can also define same-page navigations such as tabs.

```
/product/42/pricing                   /product/42/reviews
+------------------+                  +-----------------+
| Macbook          |                  | Macbook         |
| ...              |                  | ...             |
| +--------------+ |                  | +-------------+ |
| | Pricing      | |  +------------>  | | Reviews     | |
| | ...          | |                  | | ...         | |
| +--------------+ |                  | +-------------+ |
+------------------+                  +-----------------+
```

```yaml
pages/+Layout.js                      # Global layout (shared among all pages)
pages/product/@id/+Layout.js          # Outer content ("Macbook" ...)
pages/product/@id/pricing/+Page.js    # Inner content ("Pricing" ...)
pages/product/@id/reviews/+Page.js    # Inner content ("Reviews" ...)
```

Make sure to use <Link href="/clientRouting#settings">`<a href="/product/42/reviews" keep-scroll-position />`</Link> to avoid scrolling to the top.

> If your nested layout isn't associated with a URL then you can use a stateful component instead of `<Layout>`. (If the pricing and reviews tabs share the same URL `/product/42`.)

> Caching the data of the outer layout is work-in-progress, see [#1689 - [Nested Layouts] Fetch data on layout-level](https://github.com/vikejs/vike/issues/1689).

Examples:
- [React](https://github.com/vikejs/vike-react/blob/main/examples/full/pages/starship)
- [Vue](https://github.com/vikejs/vike-vue/blob/main/examples/full/pages/starship)
- [Solid](https://github.com/vikejs/vike-solid/tree/main/examples/full/pages/starship)


## Without `vike-{react,vue,solid}`

The following is for users that don't use a <UiFrameworkExtension />.

#### The simple way

A simple way to implement layouts is to manually wrap your `<Page>` components:

```jsx
// /pages/index/+Page.js

export { Page }

import { LayoutDefault } from '../layouts/LayoutDefault'

function Page() {
  return <>
    <LayoutDefault>
      {/* ... */}
    </LayoutDefault>
  </>
}
```

```jsx
// /pages/admin/+Page.js

export { Page }

import { LayoutDashboard } from '../layouts/LayoutDashboard'

function Page() {
  return <>
    <LayoutDashboard>
      {/* ... */}
    </LayoutDashboard>
  </>
}
```

#### With a custom setting

You can implement the `Layout` setting yourself by using <Link href="/meta">meta</Link>.

Examples:
 - <Link href="/meta#example-layout" doNotInferSectionTitle />
 - [`vike-react` source code](https://github.com/vikejs/vike-react/blob/main/packages/vike-react)
 - [`vike-vue` source code](https://github.com/vikejs/vike-vue/blob/main/packages/vike-vue)
 - [`vike-solid` source code](https://github.com/vikejs/vike-solid/blob/main/vike-solid)


#### Nested Layout

See the <Link href="#nested-layouts" /> section above. For smooth nested layout navigation, we recommend using <Link href="/clientRouting">Client Routing</Link>. (Using <Link href="/server-routing">Server Routing</Link> leads to full page reloads which usually isn't acceptable for same-page navigations.)


## See also

- <Link href="/Wrapper" />
- <Link href="/usePageContext" />
- <Link href="/Page" />
